plugins{
    id 'java'
}

group 'fr.xpdustry'
version '1.0'
sourceSets.main.java.srcDirs = ["src/main/java"]

sourceCompatibility = 1.8
targetCompatibility = 14

repositories{
    mavenCentral()
    maven{ url 'https://www.jitpack.io' }
}

ext{
    //the build number that this plugin is made for
    mindustryVersion = 'v126.2'
}

dependencies{
    compileOnly "com.github.Anuken.Arc:arc-core:$mindustryVersion"
    compileOnly "com.github.Anuken.Mindustry:core:$mindustryVersion"
}

jar{
    archiveFileName = "${project.archivesBaseName}.jar"

    from{
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }

    from('src/main/resources'){
        include "*"
    }
}

task deployPlugin(type:Exec){
    // A string that points directly to your server.jar directory
    def serverDirectory = "C:\\Users\\Finley\\Documents\\My Games\\Mindustry\\Server\\mindustry-server v126.2"
    
    // Delete the old jar
    delete "$serverDirectory/config/mods/${rootProject.name}.jar"

    // Copy the jar to the server.jar directory
    copy {
        from "build/libs/${rootProject.name}.jar"
        into "$serverDirectory/config/mods"
    }

    // Change the cwd and run
    workingDir = file(serverDirectory)
    commandLine = ["cmd", "/C", "start", "run_server.bat"]
}
